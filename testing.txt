def forward(e1, r, E, W):
 W_mat = torch.einsum('ijk,bi->bjk',W,r)
 
 x1 = torch.einsum('bjk,bj->bk',W_mat,e1)
 x1 = torch.einsum('bk,nk->bn',x1, E)
 x2 = torch.einsum('bjk,bk->bj',W_mat,e1)
 x2 = torch.einsum('bj,nj->bn',x2, E)
 
 return x1+x2

score1=forward(e1,r,E,W)
score2=forward(e2,r,E,W)



 x1 = torch.einsum('ijk,...i,...j,nk->...n',W,r,e1,E)
 x2 = torch.einsum('ijk,...i,...j,nk->...n',W.transpose(2,1),r,e1,E)